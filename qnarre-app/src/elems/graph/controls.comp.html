<div class="allcontrols">
  <div class="control-holder">
    <qnr-graph-node-search></qnr-graph-node-search>
  </div>
  <div class="control-holder">
    <paper-button class="icon-button" on-tap="(_fit)" alt="Fit to screen">
      <iron-icon icon="aspect-ratio" class="button-icon"></iron-icon>
      <span class="button-text">Fit to Screen</span>
    </paper-button>
  </div>
  <div class="control-holder">
    <paper-button class="icon-button" on-click="(download)" alt="Download PNG">
      <iron-icon icon="file-download" class="button-icon"></iron-icon>
      <span class="button-text">Download PNG</span>
    </paper-button>
    <a href="#" id="graphdownload" class="title" download="graph.png"></a>
  </div>
  <div class="control-holder runs">
    <div class="title">
      Run <span class="counter">([[datasets.length]])</span>
    </div>
    <paper-dropdown-menu
      no-label-float=""
      no-animations=""
      noink=""
      horizontal-align="left"
      class="run-dropdown"
    >
      <paper-listbox
        class="dropdown-content"
        selected="{{ _selectedRunIndex }}"
        slot="dropdown-content"
      >
        <template is="dom-repeat" items="[[datasets]]">
          <paper-item>[[item.name]]</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>
  </div>
  <template is="dom-if" if="[[showSessionRunsDropdown]]">
    <div class="control-holder">
      <div class="title">
        Tag
        <span class="counter">([[_numTags(datasets, _selectedRunIndex)]])</span>
      </div>
      <paper-dropdown-menu
        no-label-float=""
        no-animations=""
        horizontal-align="left"
        noink=""
        class="run-dropdown"
      >
        <paper-listbox
          class="dropdown-content"
          selected="{{ _selectedTagIndex }}"
          slot="dropdown-content"
        >
          <template
            is="dom-repeat"
            items="[[_getTags(datasets, _selectedRunIndex)]]"
          >
            <paper-item>[[item.displayName]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
    </div>
  </template>
  <template is="dom-if" if="[[showUploadButton]]">
    <div class="control-holder">
      <div class="title">Upload</div>
      <paper-button
        raised=""
        class="upload-button"
        on-click="(_getFile)"
        title="Upload a graph pbtxt file to view the graph"
      >
        Choose File
      </paper-button>
      <div class="hidden-input">
        <input
          type="file"
          id="file"
          name="file"
          on-change="(_updateFileInput)"
          accept=".pbtxt"
        />
      </div>
    </div>
  </template>
  <div class="control-holder">
    <paper-radio-group selected="{{ _selectedGraphType }}">
      <!-- Note that the name has to match that of tf.graph.SelectionType. -->
      <paper-radio-button
        name="op_graph"
        disabled="[[_getSelectionOpGraphDisabled(datasets, _selectedRunIndex, _selectedTagIndex)]]"
        >Graph</paper-radio-button
      >
      <paper-radio-button
        name="conceptual_graph"
        disabled="[[_getSelectionConceptualGraphDisabled(datasets, _selectedRunIndex, _selectedTagIndex)]]"
        >Conceptual Graph</paper-radio-button
      >
      <paper-radio-button
        name="profile"
        disabled="[[_getSelectionProfileDisabled(datasets, _selectedRunIndex, _selectedTagIndex)]]"
        >Profile</paper-radio-button
      >
    </paper-radio-group>
  </div>
  <div class="control-holder">
    <div>
      <paper-toggle-button checked="{{ traceInputs }}" class="title">
        Trace ins
      </paper-toggle-button>
    </div>
  </div>
  <template is="dom-if" if="[[healthPillsFeatureEnabled]]">
    <div class="control-holder">
      <paper-toggle-button checked="{{ healthPillsToggledOn }}" class="title"
        >Show health pills</paper-toggle-button
      >
    </div>
  </template>
  <div class="control-holder">
    <div class="title">Color</div>
    <paper-radio-group selected="{{ colorBy }}">
      <paper-radio-button name="structure">Structure</paper-radio-button>

      <paper-radio-button name="device">Device</paper-radio-button>

      <paper-radio-button
        id="xla-cluster-radio-button"
        name="xla_cluster"
        disabled="[[!_clustersProvided(renderHierarchy)]]"
      >
        XLA Cluster
      </paper-radio-button>
      <paper-tooltip
        animation-delay="0"
        for="xla-cluster-radio-button"
        position="right"
        offset="0"
      >
        Coloring by XLA cluster is only enabled if at least 1 op specifies an
        XLA cluster.
      </paper-tooltip>

      <paper-radio-button
        id="compute-time-radio-button"
        name="compute_time"
        disabled="[[!stats]]"
      >
        Compute time
      </paper-radio-button>
      <paper-tooltip
        animation-delay="0"
        for="compute-time-radio-button"
        position="right"
        offset="0"
      >
        Coloring by compute time is only enabled if the RunMetadata proto is
        passed to the FileWriter when a specific session is run.
      </paper-tooltip>

      <paper-radio-button
        id="memory-radio-button"
        name="memory"
        disabled="[[!stats]]"
      >
        Memory
      </paper-radio-button>
      <paper-tooltip
        animation-delay="0"
        for="memory-radio-button"
        position="right"
        offset="0"
      >
        Coloring by memory is only enabled if the RunMetadata proto is passed to
        the FileWriter when a specific session is run.
      </paper-tooltip>

      <paper-radio-button
        id="tpu-compatibility-radio-button"
        name="op_compatibility"
      >
        TPU Compatibility
      </paper-radio-button>
      <paper-tooltip
        animation-delay="0"
        for="tpu-compatibility-radio-button"
        position="right"
        offset="0"
      >
        Coloring by whether an operation is compatible for the TPU device.
      </paper-tooltip>
    </paper-radio-group>
    <span class="spacer"></span>
  </div>
  <div>
    <template is="dom-if" if="[[_isGradientColoring(stats, colorBy)]]">
      <svg width="140" height="20" style="margin: 0 5px" class="color-text">
        <defs>
          <linearGradient id="linearGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop
              class="start"
              offset="0%"
              stop-color\$="[[curGradPs.startColor]]"
            ></stop>
            <stop
              class="end"
              offset="100%"
              stop-color\$="[[curGradPs.endColor]]"
            ></stop>
          </linearGradient>
        </defs>
        <rect
          x="0"
          y="0"
          width="135"
          height="20"
          fill="url(#linearGradient)"
          stroke="black"
        ></rect>
      </svg>
      <div class="domainValues color-text">
        <div class="domainStart">[[curGradPs.minValue]]</div>
        <div class="domainEnd">[[curGradPs.maxValue]]</div>
      </div>
      <br style="clear: both" />
      <div>Devices included in stats:</div>
      <div class="deviceList">
        <template is="dom-repeat" items="[[curDevs]]">
          <div class="color-legend-row devices-checkbox">
            <span
              ><input
                type="checkbox"
                value\$="[[item.device]]"
                checked\$="[[item.used]]"
                on-click="(_deviceCheckboxClicked)"
            /></span>
            <span>[[item.suffix]]</span>
            <template is="dom-if" if="[[item.ignoredMsg]]">
              <paper-icon-button
                icon="help"
                class="help-icon"
              ></paper-icon-button>
              <paper-tooltip position="right" offset="0" animation-delay="0"
                >[[item.ignoredMsg]]</paper-tooltip
              >
            </template>
          </div>
        </template>
      </div>
    </template>
    <template is="dom-if" if="[[_equals(colorBy, 'structure')]]">
      <div class="color-text">
        <div class="color-legend-row">
          <span class="label">
            colors
          </span>
          <span class="color-legend-value">same substructure</span>
        </div>
        <div class="color-legend-row">
          <qnr-graph-icon
            type="META"
            height="16"
            fill-override="#eee"
            stroke-override="#a6a6a6"
          ></qnr-graph-icon>
          <span class="color-legend-value">unique substructure</span>
        </div>
      </div>
    </template>
    <template is="dom-if" if="[[_equals(colorBy, 'device')]]">
      <div>
        <template is="dom-repeat" items="[[curDevPs]]">
          <div class="color-legend-row">
            <qnr-graph-icon
              type="META"
              height="16"
              fill-override="[[item.color]]"
              stroke-override="#a6a6a6"
            ></qnr-graph-icon>
            <span class="color-legend-value">[[item.device]]</span>
          </div>
        </template>
        <div class="color-legend-row">
          <qnr-graph-icon
            type="META"
            height="16"
            fill-override="#eee"
            stroke-override="#a6a6a6"
          ></qnr-graph-icon>
          <span class="color-legend-value">unknown device</span>
        </div>
      </div>
    </template>
    <template is="dom-if" if="[[_equals(colorBy, 'xla_cluster')]]">
      <div>
        <template is="dom-repeat" items="[[curClusPs]]">
          <div class="color-legend-row">
            <svg>
              <use
                xmlns:xlink="http://www.w3.org/1999/xlink"
                xlink:href="#unfilled-rect"
                x="0"
                y="0"
                style="fill:[[item.color]]"
              ></use>
            </svg>
            <span class="color-legend-value">[[item.xla_cluster]]</span>
          </div>
        </template>
        <div class="color-legend-row">
          <svg>
            <use
              xmlns:xlink="http://www.w3.org/1999/xlink"
              xlink:href="#grey-rect"
              x="0"
              y="0"
            ></use>
          </svg>
          <span class="color-legend-value">unknown XLA cluster</span>
        </div>
      </div>
    </template>
    <template is="dom-if" if="[[_equals(colorBy, 'op_compatibility')]]">
      <div class="color-text">
        <div class="color-legend-row">
          <qnr-graph-icon
            type="OP"
            height="16"
            fill-override="#0f9d58"
            stroke-override="#ccc"
          ></qnr-graph-icon>
          <span class="color-legend-value">Valid Op</span>
        </div>
        <div class="color-legend-row">
          <qnr-graph-icon
            type="OP"
            height="16"
            fill-override="#db4437"
            stroke-override="#ccc"
          ></qnr-graph-icon>
          <span class="color-legend-value">Invalid Op</span>
        </div>
      </div>
    </template>
    <template is="dom-if" if="[[_statsNotNull(stats)]]">
      <div class="color-legend-row">
        <qnr-graph-icon type="META" height="16" faded=""></qnr-graph-icon>
        <span class="color-legend-value">unused substructure</span>
      </div>
    </template>
  </div>
</div>
<div class="legend-holder">
  <paper-icon-button
    icon="[[_getToggleLegendIcon(_legendOpened)]]"
    on-click="(_toggleLegendOpen)"
    class="toggle-legend-button"
  >
  </paper-icon-button>
  <span class="toggle-legend-text">
    [[_getToggleText(_legendOpened)]]
  </span>
  <iron-collapse opened="[[_legendOpened]]">
    <div>
      <table>
        <tbody>
          <tr>
            <td><div class="title">Graph</div></td>
            <td>(* = expandable)</td>
          </tr>
          <tr>
            <td>
              <qnr-graph-icon
                type="META"
                height="16"
                fill-override="#d9d9d9"
                stroke-override="#ccc"
              ></qnr-graph-icon>
            </td>
            <td>
              Namespace<span class="gray">*</span>
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Encapsulates a set of nodes. Namespace is hierarchical and
                  based on scope.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <qnr-graph-icon type="OP" height="16"></qnr-graph-icon>
            </td>
            <td>
              OpNode
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Node that performs an operation. These nodes cannot expand.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <qnr-graph-icon type="SERIES" height="16"></qnr-graph-icon>
            </td>
            <td>
              Unconnected series<span class="gray">*</span>
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Sequence of numbered nodes that are not connected to each
                  other.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <qnr-graph-icon
                type="SERIES"
                height="16"
                vertical=""
              ></qnr-graph-icon>
            </td>
            <td>
              Connected series<span class="gray">*</span>
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Sequence of numbered nodes that are connected to each other.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <svg class="icon">
                <circle
                  fill="white"
                  stroke="#848484"
                  cx="10"
                  cy="10"
                  r="5"
                ></circle>
              </svg>
            </td>
            <td>
              Constant
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Node that outputs a constant value.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <qnr-graph-icon type="SUMMARY" height="20"></qnr-graph-icon>
            </td>
            <td>
              Summary
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Node that collects data for visualization within TensorBoard.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <svg
                class="icon"
                height="15px"
                preserveAspectRatio="xMinYMid meet"
                viewBox="0 0 15 15"
              >
                <defs>
                  <marker
                    id="dataflow-arrowhead-legend"
                    fill="#bbb"
                    markerWidth="10"
                    markerHeight="10"
                    refX="9"
                    refY="5"
                    orient="auto-start-reverse"
                  >
                    <path d="M 0,0 L 10,5 L 0,10 C 3,7 3,3 0,0"></path>
                  </marker>
                </defs>
                <path
                  marker-end="url(#dataflow-arrowhead-legend)"
                  stroke="#bbb"
                  d="M2 9 l 29 0"
                  stroke-linecap="round"
                ></path>
              </svg>
            </td>
            <td>
              Dataflow edge
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Edge showing the data flow between operations. Edges flow
                  upwards unless arrowheads specify otherwise.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <svg
                class="icon"
                height="15px"
                preserveAspectRatio="xMinYMid meet"
                viewBox="0 0 15 15"
              >
                <path
                  stroke="#bbb"
                  d="M2 9 l 29 0"
                  stroke-linecap="round"
                  stroke-dasharray="2, 2"
                ></path>
              </svg>
            </td>
            <td>
              Control dependency edge
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Edge showing the control dependency between operations.
                </paper-tooltip>
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <svg
                class="icon"
                height="15px"
                preserveAspectRatio="xMinYMid meet"
                viewBox="0 0 15 15"
              >
                <defs>
                  <marker
                    id="reference-arrowhead-legend"
                    fill="#FFB74D"
                    markerWidth="10"
                    markerHeight="10"
                    refX="9"
                    refY="5"
                    orient="auto-start-reverse"
                  >
                    <path d="M 0,0 L 10,5 L 0,10 C 3,7 3,3 0,0"></path>
                  </marker>
                </defs>
                <path
                  marker-end="url(#reference-arrowhead-legend)"
                  stroke="#FFB74D"
                  d="M2 9 l 29 0"
                  stroke-linecap="round"
                ></path>
              </svg>
            </td>
            <td>
              Reference edge
              <div class="legend-clarifier">
                <span>?</span>
                <paper-tooltip animation-delay="0" position="right" offset="0">
                  Edge showing that the outgoing operation node can mutate the
                  incoming tensor.
                </paper-tooltip>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </iron-collapse>
</div>
